webpackJsonp([24],{llmT:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o={name:"PersonalInfo",data:function(){return{backendURL:this.$axios.defaults.baseURL,size:"",isEmpty:!0,emptyDescriptionContent:"",userInfo:{id:"",name:"",sex:"",username:"",address:"",email:"",create_time:"",enabled:"",headIcon:"",roles:[]},dialogFormVisible:!1,updateForm:{id:"",name:"",sex:"",address:""},formLabelWidth:"120px",iconDialogFormVisible:!1,iconForm:{name:""},centerDialogVisible:!1,emailForm:{id:"",email:"",verifyCode:""},rules:{email:[{required:!0,message:this.$t("personalInfo.rule1"),trigger:"blur"},{type:"email",message:this.$t("personalInfo.rule11"),trigger:["blur","change"]}],verifyCode:[{required:!0,message:this.$t("personalInfo.rule2"),trigger:"blur"}]},needWaitting:!1,sendEmailButtionMessage:this.$t("personalInfo.sendEmailButton")}},created:function(){var e=this.$cookies.get("username");e||(this.$message({message:this.$t("sessionExpired"),type:"warning"}),this.isEmpty=!0,this.$router.push("/"));var t=this;this.$axios.get("/user/getInfo/"+e).then(function(e){var s=e.data;if(console.log(s),!s.data)return t.$message({message:s.code+"~~~~"+t.$t("serverError"),type:"warning",duration:2e3}),void(t.emptyDescriptionContent=s.code+" ~~~~ "+t.$t("serverError"));var o=s.data;t.userInfo.address=o.address,t.userInfo.create_time=o.create_time,t.userInfo.email=o.email,t.userInfo.enabled=o.enabled,t.userInfo.headIcon=o.headIcon,t.userInfo.id=o.id,t.userInfo.name=o.name,t.userInfo.roles=o.roles,t.userInfo.sex=o.sex,t.userInfo.username=o.username,t.isEmpty=!1})},methods:{errorHandler:function(){return!0},updateUserInfo:function(e){if(this.dialogFormVisible=!1,this.validForm(e)){e.id=this.userInfo.id;var t=this;this.$axios.post("/user/updateInfo",e).then(function(e){var s=e.data;4001===s.code?t.$router.go(0):t.$message({message:s.code+"~~~~"+t.$t("serverError"),type:"error",duration:1500})})}},validForm:function(e){var t=e.name.replace(/\s*/g,""),s=e.sex,o=e.address.replace(/\s*/g,"");return t?s?!!o||(this.$message.error(this.$t("personalInfo.rule5")),!1):(this.$message.error(this.$t("personalInfo.rule4")),!1):(this.$message.error(this.$t("personalInfo.rule3")),!1)},handleAvatarSuccess:function(e,t){this.userInfo.headIcon=t.response.data,this.$cookies.set("user_icon",t.response.data),this.$root.$emit("updateHeadIconEvent",t.response.data)},handleAvatarFail:function(e,t){this.$message.error(e.code+"~~~~"+this.$t("serverError"))},beforeAvatarUpload:function(e){console.log(e.type);var t="image/jpeg"===e.type||"image/png"===e.type,s=e.size/1024/1024<2;return t||this.$message.error(this.$t("personalInfo.errorMessage1")),s||this.$message.error(this.$t("personalInfo.errorMessage1")),t&&s},sendEmail:function(){this.emailForm.id=this.userInfo.id;var e=this;if(this.validEmail(this.emailForm.email)){this.needWaitting=!0;var t=60,s=window.setInterval(function(){e.sendEmailButtionMessage=t+e.$t("personalInfo.suspendSending"),t<=0&&(e.needWaitting=!1,e.sendEmailButtionMessage=e.$t("personalInfo.sendEmailButton"),window.clearInterval(s)),t--},1e3);this.$axios.post("/user/sendVerifyCode",this.emailForm).then(function(t){var o=t.data;4006===o.code?e.$message({message:o.code+" ~~~~ "+e.$t("personalInfo.sendingSuccess"),type:"success",duration:1500}):(e.$message.error(o.code+" ~~~ "+e.$t("serverError")),e.needWaitting=!1,window.clearInterval(s))})}else this.$message.error(this.$t("personalInfo.rule11"))},bindEmail:function(){var e=this;if(this.emailForm.verifyCode)if(this.validEmail(this.emailForm.email)){this.emailForm.id=this.userInfo.id;var t=this;this.$axios.post("/user/bindEmail",this.emailForm).then(function(s){var o=s.data;4009===o.code?t.$router.go(0):e.$message({message:o.code+" ~~~~ "+t.$t("personalInfo.bindingFailed"),type:"error",duration:1500})})}else this.$message.error(this.$t("personalInfo.rule1"));else this.$message.error(this.$t("personalInfo.rule2"))},validEmail:function(e){return/^[A-Za-z0-9._-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$/.test(e)}}},i={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:"div_personal_info"}},[this.isEmpty?s("el-empty",{staticStyle:{margin:"20%"},attrs:{description:e.emptyDescriptionContent}}):s("div",[s("p",{staticStyle:{"line-height":"15px"}},[s("el-avatar",{attrs:{size:140},on:{error:e.errorHandler}},[this.userInfo.headIcon?s("img",{attrs:{src:this.userInfo.headIcon}}):s("img",{attrs:{src:"static/img/none.png"}})]),e._v(" "),s("br"),s("br"),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.iconDialogFormVisible=!0}}},[e._v("\n        "+e._s(e.$t("personalInfo.avatarUpload"))),s("i",{staticClass:"el-icon-upload el-icon--right"})]),e._v(" "),s("el-dialog",{attrs:{title:""+e.$t("personalInfo.avatarUpload"),visible:e.iconDialogFormVisible},on:{"update:visible":function(t){e.iconDialogFormVisible=t}}},[s("el-form",{attrs:{model:e.iconForm}},[s("el-upload",{staticClass:"upload-demo",attrs:{drag:"",name:"file","with-credentials":"",accept:".jpg,.png","on-success":e.handleAvatarSuccess,"on-error":e.handleAvatarFail,"before-upload":e.beforeAvatarUpload,action:e.backendURL+"/user/uploadIcon/"+e.userInfo.id}},[s("i",{staticClass:"el-icon-upload"}),e._v(" "),s("div",{staticClass:"el-upload__text"},[e._v("\n              "+e._s(e.$t("personalInfo.uploadPrompt"))),s("em",[e._v(e._s(e.$t("personalInfo.clickUpload")))])]),e._v(" "),s("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(e._s(e.$t("personalInfo.avatarUploadNotice")))])])],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(t){e.iconDialogFormVisible=!1}}},[e._v(e._s(e.$t("cancelButton")))]),e._v(" "),s("el-button",{attrs:{type:"primary"},on:{click:function(t){e.iconDialogFormVisible=!1}}},[e._v(e._s(e.$t("confirmButton")))])],1)],1)],1),e._v(" "),s("div",[s("form",{attrs:{action:"",disabled:""}},[s("el-descriptions",{staticClass:"margin-top",attrs:{title:""+e.$t("personalInfo.accountInfo"),column:1,size:e.size,border:""}},[s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-s-check"}),e._v("\n              "+e._s(e.$t("personalInfo.account"))+"\n            ")]),e._v(" "),this.userInfo.username?s("span",[e._v("\n            "+e._s(this.userInfo.username)+"\n          ")]):s("span",[e._v(e._s(e.$t("personalInfo.uninputed")))])],2),e._v(" "),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-user"}),e._v("\n              "+e._s(e.$t("personalInfo.alias"))+"\n            ")]),e._v(" "),this.userInfo.name?s("span",[e._v(e._s(this.userInfo.name))]):s("span",[e._v(e._s(e.$t("personalInfo.uninputed")))])],2),e._v(" "),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-question"}),e._v("\n              "+e._s(e.$t("personalInfo.gender"))+"\n            ")]),e._v(" "),this.userInfo.sex?s("span",[e._v(e._s("男"==this.userInfo.sex?this.$t("personalInfo.boy"):this.$t("personalInfo.girl")))]):s("span",[e._v(e._s(e.$t("personalInfo.uninputed")))])],2),e._v(" "),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-lock"}),e._v("\n              "+e._s(e.$t("personalInfo.accountState"))+"\n            ")]),e._v(" "),1===this.userInfo.enabled?s("span",[s("el-button",{attrs:{type:"success",round:"",size:"mini",disabled:""}},[e._v(e._s(e.$t("personalInfo.using")))])],1):s("span",[s("el-button",{attrs:{type:"danger",round:"",size:"mini",disabled:""}},[e._v(e._s(e.$t("personalInfo.locked")))])],1)],2),e._v(" "),e._l(this.userInfo.roles,function(t,o){return s("el-descriptions-item",{key:o},[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-postcard"}),e._v("\n              "+e._s(e.$t("personalInfo.system")+e.$t("personalInfo.privilege"))+" - "+e._s(o+1)+"\n            ")]),e._v(" "),s("span",t?[e._v(e._s(t)+"  "+e._s(e.$t("personalInfo.privilege")))]:[e._v(e._s(e.$t("personalInfo.uninputed")))])],2)}),e._v(" "),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-date"}),e._v("\n              "+e._s(e.$t("personalInfo.createDate"))+"\n            ")]),e._v(" "),this.userInfo.create_time?s("span",[e._v(e._s(this.userInfo.create_time))]):s("span",[e._v(e._s(e.$t("personalInfo.uninputed")))])],2),e._v(" "),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{staticClass:"el-icon-connection"}),e._v("\n              "+e._s(e.$t("personalInfo.bindedEmail"))+"\n            ")]),e._v(" "),this.userInfo.email?s("span",[e._v("\n            "+e._s(e.userInfo.email)+"\n            "),s("el-button",{staticStyle:{"margin-left":"60%"},attrs:{type:"success",size:"mini",icon:"el-icon-plus"},on:{click:function(t){e.centerDialogVisible=!0}}},[e._v(e._s(e.$t("personalInfo.modifyBinding")))])],1):s("span",[e._v("\n            "+e._s(e.$t("personalInfo.unbinded"))+"\n            "),s("el-button",{staticStyle:{"margin-left":"60%"},attrs:{type:"success",size:"mini",icon:"el-icon-plus"},on:{click:function(t){e.centerDialogVisible=!0}}},[e._v(e._s(e.$t("personalInfo.bind")))])],1),e._v(" "),s("el-dialog",{attrs:{title:""+e.$t("personalInfo.bind"),visible:e.centerDialogVisible,width:"40%",center:""},on:{"update:visible":function(t){e.centerDialogVisible=t}}},[s("p",{staticStyle:{"font-size":"15px",color:"black"}},[e._v("\n                "+e._s(e.$t("personalInfo.bindingEmailNotice1"))),s("br"),e._v("\n                "+e._s(e.$t("personalInfo.bindingEmailNotice2"))+"\n              ")]),e._v(" "),s("el-form",{staticClass:"demo-dynamic",attrs:{model:e.emailForm,"label-width":"100px"}},[s("el-form-item",{attrs:{prop:"email",label:""+e.$t("personalInfo.email"),rules:this.rules.email}},[s("el-input",{model:{value:e.emailForm.email,callback:function(t){e.$set(e.emailForm,"email",t)},expression:"emailForm.email"}})],1),e._v(" "),s("el-form-item",{staticClass:"demo-form-inline",attrs:{prop:"verifyCode",label:""+e.$t("personalInfo.verifyCode"),rules:this.rules.verifyCode}},[s("el-input",{model:{value:e.emailForm.verifyCode,callback:function(t){e.$set(e.emailForm,"verifyCode",t)},expression:"emailForm.verifyCode"}})],1)],1),e._v(" "),s("p",[s("el-button",{attrs:{type:"primary",loading:this.needWaitting},on:{click:e.sendEmail}},[e._v("\n                  "+e._s(e.sendEmailButtionMessage)+"\n                ")])],1),e._v(" "),s("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:e.bindEmail}},[e._v(e._s(e.$t("confirmButton")))]),e._v(" "),s("el-button",{on:{click:function(t){e.centerDialogVisible=!1}}},[e._v(e._s(e.$t("cancelButton")))])],1)],1)],2),e._v(" "),s("el-descriptions-item",[s("template",{slot:"label"},[s("i",{}),e._v("\n              "+e._s(e.$t("personalInfo.contact"))+"\n            ")]),e._v(" "),this.userInfo.address?s("span",[e._v(e._s(e.userInfo.address))]):s("span",[e._v(e._s(e.$t("personalInfo.uninputed")))])],2)],2),e._v(" "),s("p",[s("br"),e._v(" "),s("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.dialogFormVisible=!0}}},[e._v("\n            "+e._s(e.$t("personalInfo.modifyInfo"))+"\n            "),s("i",{staticClass:"el-icon-edit el-icon--right"})]),e._v(" "),s("el-dialog",{attrs:{title:""+e.$t("personalInfo.modifyInfo"),visible:e.dialogFormVisible},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[s("el-form",{attrs:{model:e.updateForm}},[s("el-form-item",{attrs:{label:""+e.$t("personalInfo.alias"),"label-width":e.formLabelWidth}},[s("el-input",{attrs:{autocomplete:"off"},model:{value:e.updateForm.name,callback:function(t){e.$set(e.updateForm,"name",t)},expression:"updateForm.name"}})],1),e._v(" "),s("el-form-item",{attrs:{label:""+e.$t("personalInfo.gender"),"label-width":e.formLabelWidth}},[s("el-radio-group",{model:{value:e.updateForm.sex,callback:function(t){e.$set(e.updateForm,"sex",t)},expression:"updateForm.sex"}},[s("el-radio",{attrs:{label:""+e.$t("personalInfo.boy")}}),e._v(" "),s("el-radio",{attrs:{label:""+e.$t("personalInfo.girl")}})],1)],1),e._v(" "),s("el-form-item",{attrs:{label:""+e.$t("personalInfo.contact"),"label-width":e.formLabelWidth}},[s("el-input",{attrs:{autocomplete:"off"},model:{value:e.updateForm.address,callback:function(t){e.$set(e.updateForm,"address",t)},expression:"updateForm.address"}},[e._v(e._s(e.userInfo.address))])],1)],1),e._v(" "),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.updateUserInfo(e.updateForm)}}},[e._v("\n                "+e._s(e.$t("confirmButton"))+"\n              ")]),e._v(" "),s("el-button",{on:{click:function(t){e.dialogFormVisible=!1}}},[e._v("\n                "+e._s(e.$t("cancelButton"))+"\n              ")])],1)],1)],1)],1)])])],1)},staticRenderFns:[]};var n=s("VU/8")(o,i,!1,function(e){s("w2/Z")},"data-v-0a87252d",null);t.default=n.exports},"w2/Z":function(e,t){}});
//# sourceMappingURL=24.4eb73e88a9d9cdb6e0a3.js.map